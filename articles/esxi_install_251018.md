---
title: "VMware ESXi 8.03 無償版 HPE物理サーバーでの環境構築"
emoji: "🎉"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: true
---
# はじめに
ESXiの無償版が入れられそうなため、自宅のサーバーにインストールしてみる。

# 環境
- HPE DL160
- SAS SSD 240GB *1
- SAS HDD 1TB *4
- CPU 6C/6T 
- RAM 32GB

# バージョン
- VMWare ESXi 8.03

## 概略
起動ディスクとしてSSD SASを指定し、仮想マシンの使用領域としてSAS HDDを使用する。
SSDはシングルなのでRAID 0 で作成、HDDはRAID 5 + HS1で設定。

この次は、ESXi上でAccorps VyWorksのVDI環境構築（WindowsServer2019）と、A10 Thunder仮想アプライアンスをフォワードプロキシとして利用していきたい。

## ISOの準備

1. https://support.broadcom.com/group/ecx/free-downloads から、サインインを行い、「My Downloads」に移動する。
2. 「Free Downloads」に移動し、「VMware Vsphere Hypervisor」を選択する。
3. 「8.0U3e」をクリックし、「I agree to the terms and conditions」にチェックを入れ、ダウンロードを実行する。
4. 「VMware-VMvisor-Installer-8.0U3e-24677879.x86_64.iso」をRufasなどでUSBメモリに焼く。

## インストールの実施

1. ISOを焼いたUSBメモリをサーバーに挿し、ワンタイムブートで選択する。
2. 「Loading ESXi Installer」が開始され、しばし待機。
3. 画面が黒黄に遷移し、引き続きローディング。
4. 「Welcome to the VMware ESXi 8.0.3 Installation」の画面が表示され、Enterで進む。
5. 「End User License Agreement」の画面が表示され、F11で進む。
6. 「Select a Disk to Install or Upgrade」で、インストールするディスクを選択する。今回はSSDの含まれる論理ボリュームを選択。
7. 「Please select a keyboard Layout」の画面で、「Japanese」を選択する。（英語キーボードならUS）
8. 「Enter a root password」の画面が表示され、rootアカウントのパスワードを決めます。
9. 「Error/Warning/ Found During System Scan」の画面でエラーが表示されることがある。今回はCPUが要件外だったが、Enterでそのまま進めた。
10. 「Confirm Install」の画面で最終確認が行われ、F11を押すとインストールが開始する。
11. 「Installation Complete」が表示されたら終了。Enterで再起動すると自動で起動してくる。

## ESXiクライアントへのアクセス

1. サーバーが起動すると、デフォルトはDHCPでIPを自動取得してくるため、アクセス用のURLが表示される。
2. ブラウザから、表示されているURLへアクセスする。
3. IDはroot、パスワードはセットアップ時に入力したものでサインインする。
4. サインインが問題なくできれば初期設定が完了。

## 追加ディスクの設定
インストールディスクのSSD以外は認識されていないため、新規データストアとして登録する必要がある。

1. 「ストレージ」に移動し、「新しいデータストア」をクリックする。
2. わかりやすいデータストア名を入力する。
3. 「デバイスの選択」から、割り当てるディスクを選択。今回はHDDを選択する。
4. 「パーティション分割オプションの選択」画面で、割り当てるディスク容量を選択。
5. 確認画面を進めて完了を押すと、データストアが登録される。
6. 使用時は、仮想マシンの作成時にデータストアを指定するだけでOK。

## ネットワーク設定
ネットワーク設定は、「仮想スイッチ」、「ポートグループ」の組み合わせで実施する。

1. 「仮想スイッチの作成」から、新規仮想スイッチ作成のウィザードを開始する。
2. 「vWsitch名」は好きなもの、「アップリンク」にvmnicを指定する。
3. 「モード」は待機でよく、プロトコルなども変更なしで完了する。
4. 「ポートグループの追加」から、VLAN IDと先ほど作成した仮想スイッチを選択する。
5. 仮想マシンの作成時に、作成したポートグループ、接続するIPアドレスを設定すると、そのIPが使用できる。

## VMKernel NICの作成
管理画面にアクセスするIPを追加できる。

1. 「VMKernel NICの追加」でNICを追加できる。
2. ポートグループと仮想スイッチを選択することで設定可能。

※注意点として、ポートグループは仮想マシンと同じグループは設定できない。VMKernel用のポートグループを別で作成し、仮想スイッチだけ同居することはOK。

## 仮想マシンの作成

1. 「仮想マシンの作成」をクリックする。
2. 「作成タイプ」を選択する。今回は「OVFファイルとVMDKファイルの選択」で進める。
3. ISOやOVAファイルをローカルからアップロードする。
4. 「ストレージの選択」から、使用するディスクを選択する。今回は後から追加したHDDを指定。
6. 「デプロイのオプション」はそのまま進める。
7. 「その他の設定」も変更せず進める。
8. 「設定を確認」画面で問題がなければ、完了で作成完了。
9. ファイルの読み込みに時間がかかるため、読み込み完了するまで待機してから使用する。

## まとめ、引っかかった部分
- DL160だとディスクそのまま使用できず、RAID 0として論理パーティションを作らないと選択すらできなかった。
- インストール自体は全然問題なく進められた。
- 仮想マシンのOSは、ISOもしくはOVAで準備すればいい。
- ネットワーク設定はHyper-Vの仮想スイッチマネージャーと同じように、内部や外部で細かく設定できる。ポートグループがNICグループのようなイメージで、仮想スイッチはそのままの形で使える。VMKernelだけ少し概念が違う？