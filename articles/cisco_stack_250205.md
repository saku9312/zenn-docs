---
title: "Ciscoのスタック接続の手順"
emoji: "🎉"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: true
---
## はじめに
Ciscoのスタックを組むまでにどういった手順が必要なのか、実地検証はできないが頭に入れておきたいと思い調べてみた。

## スタックケーブルでの接続
複数のスイッチを接続する場合、STPだったりイーサチャネルだったり方法があるが、今回はスイッチ背面からスタックケーブルを各スイッチ間で接続し、冗長化させることが可能。
この場合、1台が故障しても問題がないし、ループのような心配も不要になる。

## インターフェイス番号の割り振り方
スタックした際、スタックメンバー番号が付与される。これがインターフェイス番号の頭1桁に反映されるので、例えば3台並べていてもうまく番号が振られない可能性もある。

## メンバー番号の振り方
これが注意点で、初期導入時は「電源を入れた順番」で番号が振られる。

## マスターの設定方法
メンバー番号の振り方と同様で、電源を最初に入れたものがマスターになる。
ただ、こちらはあらかじめプライオリティを高く設定しておくことで、優先的にマスターにすることも可能。

    #プライオリティを15に設定する
    conf t
    switch 1 priority 15
    
もしマスターが死んでしまった場合、プライオリティに応じて他のスイッチが自動的にマスターに切り替わる。
スタックマスターやメンバー番号は、show switchで確認できる。

また、これらの設定（スタックマスターやメンバー番号）は、電源が落ちても維持される。

メンバー番号を変更したい場合は、以下のコマンドで対応可能。

    #メンバー番号を3に変更する
    conf t
    switch 4 renumber 3

## show switchのステータス
スタックのロールは「Active」「Standby」「Member」の3つが存在する。
マスターがActive、その次がStandby、その下がMemberになり、それぞれプライオリティの高い順に設定されていく。
なので、2台構成であれば「Active」「Standby」しか存在しない。

また、この障害時のロールの昇格には時間がかかり、おおよそ5分～10分ほどかかるらしい。
StandbyロールとMemberロールは自分が昇格すべきか確認する時間が必要とのこと。

## まとめ
・スタックメンバー番号は物理的な位置と揃えるようにする
・プライオリティを設定してスタックマスターを出来るだけ固定する
・追加、交換するスイッチの電源を切ってスタック接続する
・スタックを構成した時、スイッチを交換した時は必ずスタックマスターとメンバー番号を確認する

とのこと。
スタックやってみたいけれど、今のままだと触る機会がないか。

https://beginners-network.com/catalyst_config_stack.html