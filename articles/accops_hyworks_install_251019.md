---
title: "Accops HyWorks8.03 検証環境作成"
emoji: "🎉"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: true
---
# はじめに
以前構築したESXiの基盤上に、Windows Serverを入れてHyWorksの検証環境を作成してみた。
HyWorksは30日の利用期限あり。

# 環境
- HPE DL160
- SAS SSD 240GB *1
- SAS HDD 1TB *4
- CPU 10C/20T → 6C/6TからCPU交換
- RAM 32GB

- VMware ESXi 8.03
- 仮想マシン：Windows Server 2019
- SQL Server Express

# バージョン
- Accops HyWorks 3.4

## 概略
OSはWindows Server 2019にHyWorksをインストールする。
また、SQL Server Expressも必要になるため、HyWorksのインストール前に準備をする。
手元のWindowsOSから、VDIが使用できれば検証環境が完成。

## インストーラーの準備

1. https://www.accops.jp/download-module から、インストーラーとマニュアルを入手する。
2. 「HyWorks_3.4.zip」をダウンロードし、解凍後「HyWorks」「」「」を使っていく。

## 仮想マシンの作成

ここは以前の記事を参考に作成するものとする。

## Windows Server　2019のインストール

この部分も基本的な構築＋IPアドレス固定＋ホスト名変更なので省略。
ホスト名はsakuvdiとする。

## IISの有効化
今回はIISを有効にする必要があるため、以下の手順を行う。

1. 「サーバーマネージャー」から、「ツール＞役割と機能の追加」を起動。
2. 「Webサーバー（IIS）」を選択し、機能やWebサーバーの機能は特に変更せず進める。
3. インストールが完了したら、コマンドプロンプトで「C:\Windows\Microsoft.Net\Framework\v4.0.30319\aspnet_regiis.exe -iru」を実行する。
4. 「インターネットインフォメーションサービス（IIS）マネージャー」を起動する。
5. 「ホスト名＞アプリケーションプール」に、以下の2項目を追加する。
    - 名前：.Net v4.5 / .Net CLR バージョン：v4.030319（変更しない） / マネージドパイプラインモード：統合
    - 名前：.Net v4.5 Classic / .Net CLR バージョン：v4.030319（変更しない） / マネージドパイプラインモード：クラシック
6. マネージャーを終了する。

## SQL Server Express のインストール

1. https://www.microsoft.com/ja-jp/download/details.aspx?id=104781 からインストーラーをダウンロードする。
2. インストーラーを起動し、「カスタム」でインストールを開始する。
3. 「SQL Serverの新規スタンドアロン インストールを実行するか、既存のインストールに機能を追加」を選択する。
4. 「機能の選択」までは変更なく進め、「データベースエンジンサービス」のみ選択して進める。
5. 「名前付きインスタンス」は「SQLExpress」、「インスタンス」は「SQLEXPRESS」のまま進める。
6. 「サービスアカウント」は変更せず、「データベースエンジンの設定」では、「認証モード：混合モード」とし、SQLServer用のパスワードを入力する。
7. そのままインストールを進めて終了。

## SSMSのインストール

1. 「SQL Server 管理ツールのインストール」を選択し、変更なく進めて終了する。

## Microsot SQL Serverインスタンスでリモート接続を有効にする

1. SSMSを起動し、Windows認証＋暗号化：オプションで進めてデータベースに接続する。
2. ホスト名上で右クリックし、「プロパティ」を開く。
3. 「リモートサーバー接続」の「このサーバーへのリモート接続を許可する」にチェックを入れて終了する。

## SQL Serverのポート設定
SQLServerとHyWorksを静的ポートで接続するように設定する。

1. 「SQL Server構成マネージャー」を開く。
2. 「SQL Serverのサービス」を開き、「SQL Server（SQLEXPRESS）」のプロセスIDを確認する。
3. 先ほど確認したプロセスIDを使って、以下のコマンドをコマンドプロンプトで実行し、実行結果が出ない場合は作業を進める。
    - netstat -ano | find /i <先ほど確認したプロセスID>
4. 「SQL Server構成マネージャー」に戻り、「SQL Serverネットワークの構成 ＞ SQLExpressのプロトコル」を開く。
5. 「TCP/IP」を有効化し、「プロパティ」から「IPアドレス ＞ IPAⅡ」の「TCP動的ポート」の値を削除し（なにも入れない）、「TCPポート」に1433を入力する。
6. 「SQL Serverのサービス」画面から先ほどのサービスを再起動し、プロセスIDを確認する。
7. 以下のコマンドを再度実行し、1433ポートの使用が確認できれば完了。
    - netstat -ano | find /i <サービス再起動後のプロセスID>
8. 「SQL Server Browser」が停止している場合は、自動起動するように設定しておく。

## Microsoft SQL Server Compact Edition 4.0のインストール

1. https://www.microsoft.com/en-US/Download/confirmation.aspx?id=30709 から、インストーラーをダウンロードする。
2. インストーラーを実行し、変更なしでそのまま完了させる。

## HyWorks コントローラーのインストール
ようやくHyWorksのインストール作業を開始。

1. Zipを解凍し、「Controller_setup」のインストーラーを実行する。
2. 規約や保存フォルダをそのまま進める。
3. インストールするコンポーネントの選択が求められたら、「Accops HyWorks Controller Service」と「Accops HyWorks Management Console」を選択する。
4. 「Deployment Type」は「Two-Nodes Active-Passive」を選択する。 
5. データベースの情報入力では、「Database Address」には、今回は「localhost￥SQLExpress」と入力し、ポートは1433、データベース名はデフォルトの「EDCDB」で進める。認証は「Windows Authentication」を選択してadministratorで認証させる。
6. ログデータベースも同様に「localhost￥SQLExpress」で進める。。
7. 「Restore Database」は、今回チェックを入れずに進める。
8. 管理者アカウントを決め、「Login Credential」では「This Account」を選び、決めたアカウントを入力して進める。
9. ポートはデフォルトの「コントローラー：38866」、「管理画面：443」で設定する。
10. 「Confirm」で設定を確認し、インストールを開始する。
11. インストール完了後は再起動を行い、インストール完了時に表示される「https://<ホスト名>:443」にアクセスする。
12. 設定したアカウントでサインインを試し、サインインできれば完了。

## VDIで使用する仮想マシンにSession Hostのインストール
今回はVDI方式でなく、SBC方式（RDS）でWindows11にアクセスするため、操作する端末にSession Hostコントローラをインストールする。

1. Zipを解凍し、「Session_Host_setup」のインストーラーを実行する。
2. こちらは特に設定がないため、保存先だけ指定して完了。
3. 再起動を実施して、次へ進む。

## ローカルユーザーの作成

1. ローカルユーザー ＞ ＋ から登録する。
2. グループに入れる場合はグループをあらかじめ作成しておくが、この後の端末登録時にユーザーごとに登録できるため必須ではない。

## VDI接続先端末の登録

1. VDI > セッションサーバー ＞ サーバーに移動。
2. 追加をクリックして仮想マシンのIPアドレスを登録。
3. サーバーチームを「Windows Default」、重みづけを「100」に設定。
4. 「接続テスト」でPingチェック、「更新」を押してRDSが有効化されているか確認する。(DVMToolsだけインストールしてるとエラーになる)
5. エラーが出ず完了すればOK。

## ユーザーとの紐づけ設定

1. VDI > Pools ＞ デスクトッププールの選択に移動。
2. エンタイトルメントタイプ を 「ユーザーベース」を選択。
3. デスクトッププールタイプ を 「共有仮想デスクトップ」を選択。
4. サーバーチームの選択 では 「Windows Default」を選択。
5. 接続プロファイル の 「Default Profile」を選択。
6. ユーザー選択画面に移動し、作成したユーザーを検索して追加する。
7. クライアントグループは「無制限」を選択。
8. 高度設定と仮想IPは変更なしで進める。

## クライアント端末からのアクセス

1. クライアント端末でクライアントインストーラーを実行する。
2. 作成したアカウントでサインインし、設定した仮想マシンに接続する（1台だけだと自動接続）。
3. デスクトップ画面が表示され、操作できれば完了。

## まとめ
- VDIソリューションを試してみたくてやったが、RDSなどまだ理解できていない点が多いことを感じた。
- ただ、HyWorksの仕組みや構築手順を洗えたので、いい経験になった。
- インターネット分離など様々なソフトウェアがあるが、VDIはすべてのアプリケーションを実行できる点がやはり有利だと感じる。
- その分スペックが必要になるため、導入時のコストバランスは難しい印象を持った。
- 特に今回はオンプレサーバーで実施したが、実際はクラウド上でマシンを作ってアクセスする形がDRとか色々な面ではリスク回避になる可能性がある。その一方で費用の計算がしやすいオンプレも、導入検討するケースはあるのだろうと思う。