---
title: "ApexOneリプレースで結構困った備忘録"
emoji: "🎉"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: true
---
## はじめに
ApexOneのリプレース作業に少し入らせてもらい、ちょっと困った点がいくつかあったので残しておく。
本当にいらないところで結構時間を取られてしまった。


## サーバーの認証証明書のパスワードがわからない
新規構築なら全然気にする必要はないが、リプレースになると話は別。
移行先のサーバーを証明するものが何もないため、移行後にエージェントがサーバーを認証できない。

保存場所はトレンドマイクロが手順にしてくれているため割愛するが、
パスワードが分からない場合は、旧サーバーで再発行できるとのこと。
今回はパスワードあったからよかったけど、なかったら面倒だった。
あとは新規で作ってADグループポリシーでルート証明書の配布でもいいっぽい。


## 旧サーバーにSSMSが入ってない
データベースの移行が必要だが、旧サーバーにSSMSが入っていなかった。
じゃあ入れてバックアップ取るか、と思ったら、.NET4.7.2が入っていないためにインストール不可。
4.6以上ならOKと出てきたくせに、結局4.7.2を入れるまで動いてくれなかった。


## Webコンソールの挙動がおかしい
ログインして画面動かしたと思ったら、「ApexOne Masterが停止しました」と表示される。
ちょっとタブ動かしたら、「タイムアウトしました」と出る。
今回はバージョン11564で新規インストールだったが、どうやらバージョンのバグらしく、パッチの14081を適用したら改善した。

ちなみに、旧サーバーは11564で問題なく動いていた。その違いは一体。


## インストール時の設定でどれを入れていいかわからない
旧サーバーのインストール時とは手順が一部違ったらしく、
どれを入れて、どれを入れないのかが分かりにくかった。
サービスの状態とか、Webコンソール内の設定を見ながらやったが、
実際完了した後に確認すると一部異なる部分があったらしい。

Smart Protectionとかは後からでも入れられるため、データベースとかの設定だけちゃんとしていれば何とかなりそう。


## エージェントの接続先サーバー切り替え時の挙動が不安
旧サーバーから「エージェントの移動」を使って、新サーバーへの移行を行ったが、
「危険な状態」→「参照先変更」→消える→エージェント画面出てくる
みたいなのを3周ぐらいしていて、ちょっと怖かった。

ちなみに、今回は1台ずつ様子見ながら移行していたが、
他の1台を移行するたびに先ほどの状態にすべての端末がなっているように見えた。

エージェント移行すると、旧サーバーからは削除され、新サーバーのみでオンラインになる。


## データベース移行したとて完了ではない
データベースの移行が完了すると、端末の一覧は表示されるが、
あくまでガワだけができている状態。
参照先も変わっていないし、一覧が出ているだけなので注意が必要。
そのあとにエージェント移行が必要。


## まとめ
運用はしていたが構築はまた別の難しさがあった。
設定移行したのに移行できていなかったり、結局そのあたりは目で確認しないといけない…。
基本的にはトレンドマイクロの出している手順で行けます！！！（データベースは先に移行するのをおすすめ）